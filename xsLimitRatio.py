#!/usr/bin/env python

import string, re
from ROOT import *
from array import array


gROOT.SetBatch(kTRUE);
gStyle.SetOptStat(0)
gStyle.SetOptTitle(0)
gStyle.SetTitleFont(42, "XYZ")
gStyle.SetTitleSize(0.06, "XYZ")
gStyle.SetLabelFont(42, "XYZ")
gStyle.SetLabelSize(0.05, "XYZ")
gStyle.SetCanvasBorderMode(0)
gStyle.SetFrameBorderMode(0)
gStyle.SetCanvasColor(kWhite)
gStyle.SetPadTickX(1)
gStyle.SetPadTickY(1)
gStyle.SetPadLeftMargin(0.15)
gStyle.SetPadRightMargin(0.05)
gStyle.SetPadTopMargin(0.05)
gStyle.SetPadBottomMargin(0.15)
gROOT.ForceStyle()

comb = True
#comb = False

# 2-tag, f_bbbar=0.5
xs_stat = [1.3033999999999999, 1.4607000000000001, 0.29347299999999998, 0.18501600000000001, 0.13832700000000001, 0.127994, 0.140462, 0.225103, 0.22576399999999999, 0.200655, 0.16195000000000001, 0.128662, 0.10584399999999999, 0.093475000000000003, 0.10101, 0.097293599999999994, 0.075715900000000003, 0.0539578, 0.040704299999999999, 0.030914299999999999, 0.024624099999999999, 0.020415599999999999, 0.019240299999999998, 0.019855999999999999, 0.021440000000000001, 0.021494200000000001, 0.020771000000000001, 0.019616999999999999, 0.018928199999999999, 0.018233699999999999, 0.017810900000000001]
xs_sys_all = [1.5851, 1.7973399999999999, 0.409501, 0.23182, 0.16183400000000001, 0.148169, 0.16531599999999999, 0.24134900000000001, 0.26377400000000001, 0.235319, 0.19708800000000001, 0.15137500000000001, 0.123668, 0.109681, 0.110621, 0.10868999999999999, 0.092262399999999994, 0.069370899999999999, 0.051745100000000002, 0.041839300000000003, 0.0308352, 0.0249283, 0.022139599999999999, 0.021812700000000001, 0.0223783, 0.022650400000000001, 0.0223742, 0.021647300000000001, 0.0210341, 0.020220100000000001, 0.019833699999999999]
xs_sys_lumi = [1.30603, 1.4656499999999999, 0.29393000000000002, 0.18531600000000001, 0.13846900000000001, 0.12815199999999999, 0.14061899999999999, 0.22553599999999999, 0.22617300000000001, 0.200991, 0.16220899999999999, 0.12883900000000001, 0.10599, 0.093588599999999994, 0.101174, 0.097444900000000001, 0.075823199999999993, 0.054364999999999997, 0.040724000000000003, 0.030943700000000001, 0.024661599999999999, 0.020441000000000001, 0.019267800000000002, 0.019880999999999999, 0.021472999999999999, 0.021650300000000001, 0.0207964, 0.019640299999999999, 0.0189502, 0.018256100000000001, 0.017833700000000001]
xs_sys_JES = [1.3060400000000001, 1.5350200000000001, 0.34650199999999998, 0.20982000000000001, 0.144986, 0.1336, 0.14705299999999999, 0.22092000000000001, 0.23375699999999999, 0.20988799999999999, 0.173815, 0.13494700000000001, 0.112442, 0.0980182, 0.10122100000000001, 0.099394200000000002, 0.084642700000000001, 0.062989600000000007, 0.049482400000000003, 0.037835899999999999, 0.0297627, 0.023269999999999999, 0.020630200000000001, 0.0203261, 0.020911599999999999, 0.0211755, 0.020907499999999999, 0.020204099999999999, 0.019580400000000001, 0.018803, 0.0184999]
xs_sys_JER = [1.33935, 1.48034, 0.29644700000000002, 0.187001, 0.139875, 0.13151099999999999, 0.14421600000000001, 0.22867499999999999, 0.22897999999999999, 0.20661199999999999, 0.16699900000000001, 0.128938, 0.110182, 0.094836100000000007, 0.10288600000000001, 0.097552200000000006, 0.076354500000000006, 0.053727200000000003, 0.040884499999999997, 0.031128800000000002, 0.025071, 0.021056499999999999, 0.019563199999999999, 0.020094000000000001, 0.021513000000000001, 0.021764800000000001, 0.020856599999999999, 0.019723600000000001, 0.018980299999999999, 0.018350399999999999, 0.0181336]
xs_sys_btag = [1.33056, 1.5013300000000001, 0.29775099999999999, 0.188637, 0.140679, 0.13059699999999999, 0.14421900000000001, 0.23422799999999999, 0.23771900000000001, 0.2127, 0.17280200000000001, 0.13456000000000001, 0.112984, 0.099667699999999998, 0.10814699999999999, 0.104587, 0.080767699999999998, 0.056173000000000001, 0.042998599999999998, 0.032578999999999997, 0.025888399999999999, 0.021641199999999999, 0.020369399999999999, 0.021039700000000001, 0.022739800000000001, 0.023041099999999998, 0.0221365, 0.0208898, 0.020047599999999999, 0.0193259, 0.018889199999999998]
xs_sys_bkg = [1.3857600000000001, 1.5043200000000001, 0.32845999999999997, 0.200157, 0.14690400000000001, 0.13553100000000001, 0.14996699999999999, 0.233325, 0.23816000000000001, 0.20571, 0.16592499999999999, 0.13022400000000001, 0.108531, 0.095587800000000001, 0.10234699999999999, 0.098116800000000004, 0.076452699999999998, 0.053847199999999998, 0.0412615, 0.031148200000000001, 0.024752699999999999, 0.020444299999999999, 0.019264900000000001, 0.019875199999999999, 0.021527500000000001, 0.021634, 0.020828900000000001, 0.019669900000000001, 0.018929100000000001, 0.018230799999999998, 0.017842899999999998]

if comb:
 # Combined, f_bbbar=0.5
 xs_stat = [1.18777, 1.0565599999999999, 0.30576399999999998, 0.155527, 0.10759100000000001, 0.100947, 0.107927, 0.135515, 0.084655900000000006, 0.065122600000000003, 0.076994599999999996, 0.090357499999999993, 0.069362199999999999, 0.051866799999999998, 0.048827299999999997, 0.053701600000000002, 0.047150200000000003, 0.031871299999999998, 0.018550299999999999, 0.0129099, 0.0100804, 0.0074750900000000002, 0.0059274699999999998, 0.0051902199999999997, 0.0053258100000000003, 0.00508882, 0.00434951, 0.0042000500000000003, 0.00380935, 0.0032894, 0.0030315300000000002]
 xs_sys_all = [1.28007, 1.1842699999999999, 0.367566, 0.192186, 0.119537, 0.10804, 0.114817, 0.13850999999999999, 0.098569799999999999, 0.075354599999999994, 0.081570000000000004, 0.091896099999999994, 0.077500299999999994, 0.060370100000000003, 0.052438199999999997, 0.054162200000000001, 0.050496100000000002, 0.040505100000000002, 0.026117100000000001, 0.018084599999999999, 0.013157500000000001, 0.0092849600000000001, 0.0073081800000000001, 0.0058640000000000003, 0.0052933700000000004, 0.0049809800000000003, 0.0046586700000000002, 0.0042748999999999999, 0.0039435299999999998, 0.0036223100000000001, 0.0034042199999999999]
 xs_sys_lumi = [1.19096, 1.0633600000000001, 0.30627100000000002, 0.156003, 0.10337499999999999, 0.101081, 0.10815, 0.13578499999999999, 0.084746000000000002, 0.065197000000000005, 0.077099200000000007, 0.090466400000000002, 0.069618799999999995, 0.051964799999999998, 0.048900600000000002, 0.053793500000000001, 0.047249100000000002, 0.031992100000000002, 0.018575299999999999, 0.012918900000000001, 0.010085200000000001, 0.0074824899999999996, 0.00593357, 0.0051974200000000003, 0.0053330399999999998, 0.0050971599999999999, 0.0043546699999999997, 0.0042055699999999996, 0.00381358, 0.00329175, 0.0030320600000000001]
 xs_sys_JES = [1.19157, 1.1413500000000001, 0.34253600000000001, 0.17820900000000001, 0.111932, 0.103683, 0.108641, 0.13361600000000001, 0.092588599999999993, 0.0705345, 0.078231800000000004, 0.089373599999999997, 0.074923600000000007, 0.057638799999999997, 0.050787400000000003, 0.053478499999999998, 0.0499835, 0.039532400000000002, 0.025686199999999999, 0.017184399999999999, 0.012752400000000001, 0.0089996099999999999, 0.0071141499999999996, 0.0057295100000000002, 0.0052619299999999997, 0.00496132, 0.004646, 0.0042576000000000003, 0.0039212400000000003, 0.0035662900000000002, 0.0033702699999999999]
 xs_sys_JER = [1.2284900000000001, 1.0737099999999999, 0.30873499999999998, 0.15750400000000001, 0.104713, 0.10245700000000001, 0.109982, 0.13728199999999999, 0.086160700000000007, 0.067525699999999994, 0.079417600000000005, 0.0916521, 0.071808899999999995, 0.0538567, 0.050233600000000003, 0.054036000000000001, 0.0472548, 0.032277199999999999, 0.0186249, 0.013136800000000001, 0.010109999999999999, 0.0075698500000000004, 0.0060640199999999998, 0.0052924499999999998, 0.0053488399999999997, 0.0051069699999999997, 0.0044245400000000002, 0.0041740199999999996, 0.0038293699999999999, 0.0033239900000000002, 0.0030539899999999999]
 xs_sys_btag = [1.19608, 1.06358, 0.30700899999999998, 0.156944, 0.103676, 0.101395, 0.10839, 0.13523099999999999, 0.0842392, 0.064813599999999999, 0.076678099999999999, 0.090610300000000005, 0.069737099999999996, 0.0518237, 0.048728100000000003, 0.053593399999999999, 0.047120599999999999, 0.031872200000000003, 0.0185097, 0.012877100000000001, 0.0100696, 0.0074670099999999996, 0.0059210399999999998, 0.0051807800000000003, 0.0053127399999999998, 0.0050742299999999999, 0.0043386400000000004, 0.00419309, 0.0038072900000000001, 0.0032902500000000002, 0.0030326799999999998]
 xs_sys_bkg = [1.2186699999999999, 1.0856699999999999, 0.31779499999999999, 0.16172400000000001, 0.10613, 0.104145, 0.112343, 0.138741, 0.088097999999999996, 0.067379099999999997, 0.078844999999999998, 0.091602299999999998, 0.070550100000000004, 0.052719299999999997, 0.0493011, 0.053981700000000001, 0.047447099999999999, 0.032117300000000001, 0.018675899999999999, 0.0129873, 0.0101323, 0.0074861600000000004, 0.0059262100000000003, 0.0051853799999999999, 0.0053273299999999999, 0.0050845200000000004, 0.00434908, 0.0041970100000000002, 0.0038073500000000001, 0.0032875600000000001, 0.0030309199999999999]

masses = array('d', [1000.0, 1100.0, 1200.0, 1300.0, 1400.0, 1500.0, 1600.0, 1700.0, 1800.0, 1900.0, 2000.0, 2100.0, 2200.0, 2300.0, 2400.0, 2500.0, 2600.0, 2700.0, 2800.0, 2900.0, 3000.0, 3100.0, 3200.0, 3300.0, 3400.0, 3500.0, 3600.0, 3700.0, 3800.0, 3900.0, 4000.0])

r_all = array('d')
r_lumi = array('d')
r_JES = array('d')
r_JER = array('d')
r_btag = array('d')
r_bkg = array('d')

for i in range(0,len(xs_stat)):
  r_all.append( xs_sys_all[i] / xs_stat[i] )
  r_lumi.append( xs_sys_lumi[i] / xs_stat[i] )
  r_JES.append( xs_sys_JES[i] / xs_stat[i] )
  r_JER.append( xs_sys_JER[i] / xs_stat[i] )
  r_btag.append( xs_sys_btag[i] / xs_stat[i] )
  r_bkg.append( xs_sys_bkg[i] / xs_stat[i] )

g_lumi = TGraph(len(masses),masses,r_lumi)
g_lumi.SetMarkerStyle(24)
g_lumi.SetMarkerColor(kGreen+2)
g_lumi.SetLineWidth(2)
g_lumi.SetLineStyle(2)
g_lumi.SetLineColor(kGreen+2)
g_lumi.GetXaxis().SetTitle("Resonance Mass [GeV]")
g_lumi.GetYaxis().SetTitle("Upper Limit Ratio (Syst./Stat. only)")
g_lumi.GetYaxis().SetRangeUser(0.30,2.05)
g_lumi.GetXaxis().SetNdivisions(1005)

g_JES = TGraph(len(masses),masses,r_JES)
g_JES.SetMarkerStyle(25)
g_JES.SetMarkerColor(kBlue)
g_JES.SetLineWidth(2)
g_JES.SetLineStyle(3)
g_JES.SetLineColor(kBlue)

g_JER = TGraph(len(masses),masses,r_JER)
g_JER.SetMarkerStyle(26)
g_JER.SetMarkerColor(45)
g_JER.SetLineWidth(2)
g_JER.SetLineStyle(4)
g_JER.SetLineColor(45)

g_btag = TGraph(len(masses),masses,r_btag)
g_btag.SetMarkerStyle(27)
g_btag.SetMarkerColor(kMagenta)
g_btag.SetLineWidth(2)
g_btag.SetLineStyle(5)
g_btag.SetLineColor(kMagenta)

g_bkg = TGraph(len(masses),masses,r_bkg)
g_bkg.SetMarkerStyle(30)
g_bkg.SetMarkerColor(kRed)
g_bkg.SetLineWidth(2)
g_bkg.SetLineStyle(6)
g_bkg.SetLineColor(kRed)

g_all = TGraph(len(masses),masses,r_all)
g_all.SetMarkerStyle(20)
g_all.SetMarkerColor(kBlack)
g_all.SetLineWidth(2)
g_all.SetLineStyle(1)
g_all.SetLineColor(kBlack)

c = TCanvas("c", "",800,800)
c.cd()

g_lumi.Draw("ALP")
g_JES.Draw("LP")
g_JER.Draw("LP")
g_btag.Draw("LP")
g_bkg.Draw("LP")
g_all.Draw("LP")

legend = TLegend(.20,.65,.60,.85)
legend.SetBorderSize(0)
legend.SetFillColor(0)
legend.SetFillStyle(0)
legend.SetTextFont(42)
legend.SetTextSize(0.03)
legend.AddEntry(g_all, "All / Stat. only","lp")
legend.AddEntry(g_JES, "JES / Stat. only","lp")
legend.AddEntry(g_JER, "JER / Stat. only","lp")
legend.AddEntry(g_bkg, "Background / Stat. only","lp")
legend.AddEntry(g_btag, "b-tag SF / Stat. only","lp")
legend.AddEntry(g_lumi, "Lumi / Stat. only","lp")

legend.Draw()

l1 = TLatex()
l1.SetTextAlign(12)
l1.SetTextFont(42)
l1.SetNDC()
l1.SetTextSize(0.035)
l1.DrawLatex(0.70,0.35, "f_{b#bar{b}} = #frac{BR(X#rightarrowb#bar{b})}{BR(X#rightarrowjj)}")
l1.SetTextSize(0.04)
l1.DrawLatex(0.18,0.89, "gg/bb, f_{b#bar{b}} = 0.5")
l1.SetTextSize(0.04)
l1.DrawLatex(0.18,0.43, "CMS Preliminary")
l1.DrawLatex(0.18,0.35, "#intLdt = 5 fb^{-1}")
l1.DrawLatex(0.19,0.30, "#sqrt{s} = 7 TeV")
l1.DrawLatex(0.18,0.25, "|#eta| < 2.5, |#Delta#eta| < 1.3")
l1.DrawLatex(0.18,0.20, "Wide Jets")
l1.SetTextSize(0.055)
if comb: l1.DrawLatex(0.54,0.205, "0, 1 and 2 b-tags")
else:    l1.DrawLatex(0.73,0.205, "2 b-tags")

if comb: c.SaveAs('CSVL_Combined_xs_limit_ratio_WideJets_RSG_fbbbar0p5.eps')
else:    c.SaveAs('CSVL_2Tag_xs_limit_ratio_WideJets_RSG_fbbbar0p5.eps')

